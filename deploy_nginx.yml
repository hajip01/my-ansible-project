---
- name: éƒ¨ç½²Nginx WebæœåŠ¡å™¨
  hosts: ubuntu_servers  # è¿™é‡Œæ›¿æ¢ä¸ºä½ çš„ä¸»æœºç»„å
  become: yes  # ä½¿ç”¨sudoæƒé™
  
  # å®šä¹‰å˜é‡
  vars:
    nginx_port: 8080  # æ”¹ä¸º8080ç«¯å£
    nginx_root: /var/www/myapp
  
  # ä»»åŠ¡åˆ—è¡¨
  tasks:
    # 1. æ›´æ–°aptç¼“å­˜
    - name: æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
      apt:
        update_cache: yes
    
    # 2. å®‰è£…Nginx
    - name: å®‰è£…Nginx
      apt:
        name: nginx
        state: present
    
    # 3. åˆ›å»ºç½‘ç«™ç›®å½•
    - name: åˆ›å»ºç½‘ç«™æ ¹ç›®å½•
      file:
        path: "{{ nginx_root }}"
        state: directory
        mode: '0755'
    
    # 4. å¤åˆ¶ç®€å•çš„æµ‹è¯•é¡µé¢
    - name: éƒ¨ç½²æµ‹è¯•é¡µé¢
      copy:
        content: |
          <!DOCTYPE html>
          <html>
          <head>
            <title>Ansibleéƒ¨ç½²æµ‹è¯•</title>
          </head>
          <body>
            <h1>ğŸ‰ æˆåŠŸï¼</h1>
            <p>è¿™æ˜¯ç”±Ansibleè‡ªåŠ¨éƒ¨ç½²çš„NginxæœåŠ¡</p>
            <p>ç«¯å£: {{ nginx_port }}</p>
            <p>æ—¶é—´: {{ ansible_date_time.date }}</p>
          </body>
          </html>
        dest: "{{ nginx_root }}/index.html"
        mode: '0644'
    
    # 5. ä½¿ç”¨templateç”ŸæˆNginxé…ç½®
    - name: é…ç½®Nginxï¼ˆä½¿ç”¨æ¨¡æ¿ï¼‰
      template:
        src: nginx.conf.j2  # æ¨¡æ¿æ–‡ä»¶
        dest: /etc/nginx/sites-available/default
      notify: é‡å¯Nginx
    
    # 6. å¯ç”¨NginxæœåŠ¡
    - name: å¯åŠ¨NginxæœåŠ¡
      service:
        name: nginx
        state: started
        enabled: yes
  
  # å¤„ç†ç¨‹åºï¼ˆåªæœ‰è¢«notifyæ—¶æ‰æ‰§è¡Œï¼‰
  handlers:
    - name: é‡å¯Nginx
      service:
        name: nginx
        state: restarted
